<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
      <meta name="description" content="">
      <meta name="author" content="">
      <title>Cake Ordering - Dashboard</title>
      <link rel="stylesheet" type="text/css" href="../assets/lib/stroke-7/style.css"/>
      <link rel="stylesheet" type="text/css" href="../assets/lib/jquery.nanoscroller/css/nanoscroller.css"/>
      <link rel="stylesheet" type="text/css" href="../assets/lib/datatable/css/dataTables.bootstrap.min.css"/>
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
      <link href="../assets/plugins/notify/pnotify.core.css" rel="stylesheet">
      <!-- notification -->
      <link href="../assets/plugins/datapicker/datepicker3.css" rel="stylesheet">
      <link type="text/css" href="../assets/css/style.css" rel="stylesheet">
      <style>
         .glyphicon.spinning {
         animation: spin 1s infinite linear;
         -webkit-animation: spin2 1s infinite linear;
         }
         @keyframes spin {
         from { transform: scale(1) rotate(0deg); }
         to { transform: scale(1) rotate(360deg); }
         }
         @-webkit-keyframes spin2 {
         from { -webkit-transform: rotate(0deg); }
         to { -webkit-transform: rotate(360deg); }
         }
         .toolbar{
         float: left;
         }
      </style>
   </head>
   <body>
      <div class="am-wrapper">
      <nav class="navbar navbar-default navbar-fixed-top am-top-header">
         <div class="container-fluid">
            <div class="navbar-header">
               <div class="page-title"><span>Dashboard</span></div>
               <a href="#" class="am-toggle-left-sidebar navbar-toggle collapsed"><span class="icon-bar"><span></span><span></span><span></span></span></a><a href="index.html" class="navbar-brand"></a>
            </div>
            <a href="#" data-toggle="collapse" data-target="#am-navbar-collapse" class="am-toggle-top-header-menu collapsed"><span class="icon s7-angle-down"></span></a>
            <div id="am-navbar-collapse" class="collapse navbar-collapse">
               <ul class="nav navbar-nav navbar-right am-user-nav">
                  <li class="dropdown">
                     <a href="#" data-toggle="dropdown" role="button" aria-expanded="false" class="dropdown-toggle"><img src="../assets/img/anonymous-icon.png"><span class="user-name">Admin Admin</span><span class="angle-down s7-angle-down"></span></a>
                     <ul role="menu" class="dropdown-menu">
                        <li><a href="#"> <span class="icon s7-user"></span>My profile</a></li>
                        <li><a href="#"> <span class="icon s7-config"></span>Settings</a></li>
                        <li><a href="#"> <span class="icon s7-help1"></span>Help</a></li>
                        <li><a href="../"> <span class="icon s7-power"></span>Sign Out</a></li>
                     </ul>
                  </li>
               </ul>
            </div>
         </div>
      </nav>
      <div class="am-left-sidebar">
         <div class="content">
            <div class="am-logo"></div>
            <ul class="sidebar-elements">
               <li class="parent"><a href="../dashboard"><i class="icon s7-monitor"></i><span>Dashboard</span></a>
               </li>
               </li>
               <li class="parent">
                  <a href="#"><i class="icon s7-graph"></i><span>Transactions</span></a>
                  <ul class="sub-menu">
                     <li><a href="#">Orders</a>
                     </li>
                     <li><a href="#"></a>
                     </li>
                     <li><a href="#"></a>
                     </li>
                  </ul>
               </li>
               <li class="parent">
                  <a href="#"><i class="icon s7-ribbon"></i><span>Management</span></a>
                  <ul class="sub-menu">
                     <li><a href="../users">User Management</a>
                     </li>
                     <li><a href="../">Customers</a>
                     </li>
                     <li><a href="../">Cake Management</a>
                     </li>
                  </ul>
               </li>
               <li class="parent">
                  <a href="#"><i class="icon s7-box2"></i><span>Setting</span></a>
                  <ul class="sub-menu">
                     <li><a href="#"></a>
                     </li>
                     <li><a href="#"></a>
                     </li>
                  </ul>
               </li>
               <li class="parent"><a href="#"><i class="icon s7-box2"></i><span>System</span></a>
               </li>
               <li class="parent"><a href="#"><i class="icon s7-box1"></i><span>Reports</span></a>
            </ul>
            <!--Sidebar bottom content-->
         </div>
      </div>
      <div class="am-content">
         <div class="page-head">
            <h2>User Managament</h2>
            <ol class="breadcrumb">
               <li><a href="#">Home</a></li>
               <li><a href="#">Management</a></li>
               <li class="active">User Management</li>
            </ol>
         </div>
         <div class="main-content">
            <div class="row">
               <div class="col-lg-12">
                  <div class="panel-group" id="accordion">
                     <div class="panel">
                        <div class="panel-heading">
                           <h4 class="panel-title">
                              <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                              <span>
                              <b><i class="glyph-icon icon-users"></i> Users Info</b>
                              </span>
                              </a>
                           </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse collapse in">
                           <div class="panel-body">
                              <div class="example-box-wrapper">
                                 <table id="list" cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered">
                                    <thead>
                                       <tr>
                                          <th>UserID</th>
                                          <th>Fullname</th>
                                          <th>Address</th>
                                          <th>Email</th>
                                          <th>Contact No#</th>
                                          <th>Birthdate</th>
                                          <th>Action</th>
                                       </tr>
                                    </thead>
                                    <tbody>
                                       <!--- Content Goes Here -->
                                    </tbody>
                                 </table>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <!--modal members-->
      <div class="modal fade" id="modal_form" tabindex="-1" role="dialog" aria-labelledby="modal_formLabel" aria-hidden="true">
         <div class="modal-dialog modal-lg" >
            <div class="modal-content">
               <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><b>&times;</b></button>
                  <h4 class="modal-title"><b><i class="glyphicon glyphicon-bars"></i> User Registration</b></h4>
               </div>
               <div class="modal-body">
                  <form id="frm_data" class="form-horizontal">
                     <div class="row">
                        <div class="col-lg-6">
                           <div class="form-group">
                              <label class="col-sm-4 control-label"> Firstname: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control" name="user_fname" id="user_fname" placeholder="Firstname" data-error-msg="Firstname is required." required>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label"> Lastname: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control" name="user_lname" id="user_lname" placeholder="Lastname" data-error-msg="Lastname is required." required>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Middlename: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control" name="user_mname" id="user_mname" placeholder="Middlename" data-error-msg="Middlename is required." required>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label"> Email: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control" name="user_email" id="user_email" placeholder="Email Address" data-error-msg="Email is required." required>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Contact No: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control" name="contact_no" id="contact_no" placeholder="Mobile">
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Birthdate: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control date-picker" name="user_bdate" id="user_bdate" placeholder="01/01/1970">
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Address: </label>
                              <div class="col-sm-8">
                                 <textarea type="text" class="form-control"   name="address" id="address" placeholder=""></textarea>
                              </div>
                           </div>
                        </div>
                        <div class="col-lg-6">
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Username: </label>
                              <div class="col-sm-8">
                                 <input type="text" class="form-control" name="user_uname" id="user_uname" placeholder="Username"  data-error-msg="Username is required." required>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Password : </label>
                              <div class="col-sm-8">
                                 <input type="password" class="form-control" name="user_pword" id="user_pword" placeholder="Password">
                                 <span id="span_note" class="help-block m-b-none" style="display: none;">Leave it blank if you do not want to update the password.</span>
                              </div>
                           </div>
                           <div class="form-group">
                              <label class="col-sm-4 control-label">Confirm: </label>
                              <div class="col-sm-8">
                                 <input type="password" class="form-control"  name="user_cpword" id="user_cpword" placeholder="Confirm Password">
                              </div>
                           </div>
                        </div>
                     </div>
                  </form>
               </div>
               <div class="modal-footer">
                  <button id="btn_save_record" type="button" class="btn btn-primary"><i class="glyphicon glyphicon-check-circle-o"></i> Record >></button>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               </div>
            </div>
         </div>
      </div>
      <!--modal members-->
      <div id="modal_confirmation" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
         <div class="modal-dialog modal-sm">
            <div class="modal-content">
               <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                  <h4 class="modal-title">Confirmation</h4>
               </div>
               <div class="modal-body">
                  <p>Are you sure you want to delete this?</p>
               </div>
               <div class="modal-footer">
                  <button id="confirm_delete" type="button" class="btn btn-warning"><i class="glyph-icon icon-trash"></i> Confirm</button>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
               </div>
            </div>
         </div>
      </div>
      <script src="../assets/lib/jquery/jquery.min.js" type="text/javascript"></script>
      <script src="../assets/lib/jquery.nanoscroller/javascripts/jquery.nanoscroller.min.js" type="text/javascript"></script>
      <script src="../assets/js/main.js" type="text/javascript"></script>
      <script src="../assets/lib/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
      <!-- PNotify -->
      <script type="text/javascript" src="../assets/plugins/notify/pnotify.core.js"></script>
      <script type="text/javascript" src="../assets/plugins/notify/pnotify.buttons.js"></script>
      <script type="text/javascript" src="../assets/plugins/notify/pnotify.nonblock.js"></script>
      <script type="text/javascript" src="../assets/lib/datatable/js/datatable.js"></script>
      <script type="text/javascript" src="../assets/lib/datatable/js/datatable-bootstrap.js"></script>
      <script type="text/javascript" src="../assets/lib/datatable/js/datatable-tabletools.js"></script>
      <!-- Data picker -->
<script src="../assets/plugins/datapicker/bootstrap-datepicker.js"></script>
      <script type="text/javascript" src="../assets/js/main.script.js"></script>
      <script type="text/javascript">
         $(document).ready(function(){
          //initialize the javascript
          App.init();
           
         
         });
      </script>
      <script>
         $(document).ready(function() {
             var _txnMode;
             var oTable;
             var oSelectedRow;


              //initialize datepicker fields
    $('.date-picker').val("");
    $('.date-picker').datepicker({
        todayBtn: "linked",
        keyboardNavigation: false,
        forceParse: false,
        calendarWeeks: true,
        autoclose: true
    });



         
             //*******************************************************************************************************************
             var initializeControls = function() {
                 oTable = $('#list').DataTable({
                     "dom": '<"toolbar">frtip',
                     "bLengthChange": false,
                     "ajax": http+"/Users/transaction/list",
                     "columns": [
         
                         {
                             targets: [1],
                             data: "user_account_id"
                         },
                         {
                             targets: [2],
                             data: "user_fullname"
                         },
                         {
                             targets: [3],
                             data: "address"
                         },
                         {
                             targets: [4],
                             data: "user_email"
                         },
                         {
                             targets: [5],
                             data: "contact_no"
                         },
                         {
                             targets: [6],
                             data: "user_bdate"
                         },
         
         
         
                         {
                             targets: [7],
                             render: function(data, type, full, meta) {
                                 return '<center><a href="#" id="edit_info" class="btn btn-info"><i class="glyphicon glyphicon-pencil"></i></a> <a href="#" id="delete_info" class="btn btn-danger"><i class="glyphicon glyphicon-trash"></i></a></center>';
                             }
                         }
         
                     ]
                 });
         
                 var createToolBarButton = function() {
                     var _btnNew = '<button class="btn btn-info"  id="btn_new" data-toggle="modal" data-target="" data-placement="left" title="Register User Account" >' +
                         '<i class="glyph-icon icon-users"></i> <b>Register User Account</b></button>';
                     $("div.toolbar").html(_btnNew);
                 }();
         
         
         
         
             }();
             //*******************************************************************************************************************
         
         
         
             var bindEventHandlers = function() {
         
                 //new
                 $('#btn_new').click(function() {
                     _txnMode = "new";
                     var m = $('#modal_form');
                     $('#span_note').hide();
                     clearFields(m);
                     m.modal('show');
                        $('.date-picker').val("");
                 });
         
                 //delete
                 $('#list').on('click', '#delete_info', function() {
                     oSelectedRow = $(this).closest('tr'); //selected row
                     $('#modal_confirmation').modal('show');
         
                 });
         
                 //confirm delete
                 $('#confirm_delete').click(function() {
                     //alert("ENTER OVERRIDE HERE!!!!");
                     $('#modal_confirmation').modal('hide');
                     var u = oTable.row(oSelectedRow).data();
                     $.ajax({
                         "dataType": "json",
                         "type": "POST",
                         "url": http+"Users/transaction/delete",
                         "data": [{
                             name: "user_account_id",
                             value: u.user_account_id
                         }]
                     }).done(function(response) {
                         showNotification(response);
                         if (response.stat == "success") {
                             oTable.row(oSelectedRow).remove().draw();
                         }
         
                     });
                 });
         
         
                 //edit
                 $('#list').on('click', '#edit_info', function() {
                     _txnMode = "edit";
                     oSelectedRow = $(this).closest('tr');
                     var data = oTable.row(oSelectedRow).data();
                     var _parent = $('#modal_form');
                     $('input,textarea', _parent).each(function() {
                         var _elem = $(this);
                         $.each(data, function(name, value) {
                             if (_elem.attr('name') == name) {
                                 _elem.val(value);
                             }
                         });
                     });
         
                     $('#span_note').show();
                     
                     $('input[name="user_pword"]').val("");
                     $('#modal_form').modal('show');
         
                 });
         
         
                 //save
                 $('#btn_save_record').click(function() {
                     var btn = $(this);
                     var f = $('#frm_data');
         
                     if (validateRequiredFields(f)) {
         
                         var _data = f.serializeArray(); //serialize data in array format
         
                         if (_txnMode == "new") {
                             //save new card info
                             $.ajax({
                                 "dataType": "json",
                                 "type": "POST",
                                 "url": http+"Users/transaction/create",
                                 "data": _data,
                                 "beforeSend": function() {
                                     showSpinningProgress(btn);
                                 },
                                 error: function(xhr, status, error) {
                                     // check status && error
                                     console.log(xhr);
                                 }
                             }).done(function(response) {
                                 showNotification(response);
                                 if (response.stat == "success") {
                                     //oTable.row(oSelectedRow).data(response.row_added[0]).draw();
                                     oTable.row.add(response.row_added[0]).draw(); //add new data to user table
                                     clearFields(f); //clear all form fields
                                    $('.date-picker').val("");
                                 }
         
                             }).always(function() {
                                 showSpinningProgress(btn);
                             });
                         } else {
         
                             var d = oTable.row(oSelectedRow).data();
                             _data.push({
                                 name: "user_account_id",
                                 value: d.user_account_id
                             });
                             $.ajax({
                                 "dataType": "json",
                                 "type": "POST",
                                 "url": http+"Users/transaction/update",
                                 "data": _data,
                                 "beforeSend": function() {
                                         showSpinningProgress(btn);
                                     }
         
                                     ,
                                 error: function(xhr, status, error) {
                                     // check status && error
                                     console.log(xhr);
                                 }
         
                             }).done(function(response) {
                                 showNotification(response);
                                 if (response.stat == "success") {
                                     oTable.row(oSelectedRow).data(response.row_updated[0]).draw();
                                     clearFields(f); //clear all form fields
                                     $('#modal_form').modal('hide');
                                 }
         
                             }).always(function() {
                                 showSpinningProgress(btn);
                             });
                         }
         
         
                     }
                 });
         
             }();
         
         
         
         
         });
      </script>
   </body>
</html>